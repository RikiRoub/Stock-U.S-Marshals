<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Profils des Agents - HC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f7f9fc; }
h1 { text-align:center; margin-bottom:20px; }
#profiles-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; }
.profile-card { background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); text-align:center; }
.profile-card img { width:100px; height:100px; border-radius:50%; object-fit:cover; border:2px solid #4D96FF; margin-bottom:10px; }
.profile-card h2 { margin:10px 0 5px; }
.profile-card p { margin:5px 0; font-size:14px; }
</style>
</head>
<body>

<h1>Liste des Profils - HC</h1>
<p id="welcome-msg"></p>
<div id="profiles-container"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDArc4SUw3MO06QJwD6xzEKsuKFsfVcjsQ",
    authDomain: "gestion-stock-d63d0.firebaseapp.com",
    projectId: "gestion-stock-d63d0",
    storageBucket: "gestion-stock-d63d0.appspot.com",
    messagingSenderId: "865227689174",
    appId: "1:865227689174:web:213e7f6e44f183c6928d77"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const defaultPic = "https://via.placeholder.com/120";

// Rendu des profils
function renderProfiles(profiles){
  const container = document.getElementById("profiles-container");
  container.innerHTML = "";
  profiles.forEach(profile => {
    const card = document.createElement("div");
    card.className = "profile-card";
    card.innerHTML = `
      <img src="${profile.photoURL || defaultPic}" alt="Photo">
      <h2>${profile.fullName || "Nom inconnu"}</h2>
      <p><i class="bi bi-envelope"></i> ${profile.email || ""}</p>
      <p><i class="bi bi-telephone"></i> ${profile.phone || ""}</p>
      <p><i class="bi bi-person-badge"></i> Matricule : ${profile.matricule || ""}</p>
      <p><i class="bi bi-bank"></i> RIB : ${profile.rib || ""}</p>
    `;
    container.appendChild(card);
  });
}

// Vérification Auth
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    document.body.innerHTML = "<h2>Accès refusé. Veuillez vous connecter.</h2>";
    return;
  }
  document.getElementById("welcome-msg").innerText = `Bienvenue ${user.email}`;

  // Vérification du rôle HC
  const roleSnap = await getDoc(doc(db,"roles",user.uid));
  const userRole = roleSnap.exists() ? roleSnap.data().role?.toLowerCase().trim() : null;

  if(userRole !== "hc"){
      document.body.innerHTML="<h2>Accès réservé aux utilisateurs HC.</h2>";
      return;
  }

  // Charger tous les profils
  const querySnap = await getDocs(collection(db,"profiles"));
  const profiles = [];
  querySnap.forEach(docSnap => profiles.push(docSnap.data()));
  renderProfiles(profiles);
});
</script>

</body>
</html>
