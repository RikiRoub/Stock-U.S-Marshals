<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Liste des Comptes - HC</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f7f9fc; }
h1 { text-align:center; margin-bottom:20px; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #ddd; padding:10px; text-align:center; }
th { background:#4D96FF; color:white; }
button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
.save-btn { background:#28a745; color:white; }
</style>
</head>
<body>

<h1>Liste des Comptes Utilisateurs - HC</h1>
<p id="welcome-msg"></p>

<table id="users-table">
  <thead>
    <tr>
      <th>Nom</th>
      <th>Email</th>
      <th>Matricule</th>
      <th>TÃ©lÃ©phone</th>
      <th>RIB</th>
      <th>RÃ´les</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDArc4SUw3MO06QJwD6xzEKsuKFsfVcjsQ",
    authDomain: "gestion-stock-d63d0.firebaseapp.com",
    projectId: "gestion-stock-d63d0",
    storageBucket: "gestion-stock-d63d0.appspot.com",
    messagingSenderId: "865227689174",
    appId: "1:865227689174:web:213e7f6e44f183c6928d77"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const tableBody = document.querySelector("#users-table tbody");

onAuthStateChanged(auth, async (user)=>{
  if(!user){ document.body.innerHTML="<h2>AccÃ¨s refusÃ©. Connectez-vous.</h2>"; return; }
  document.getElementById("welcome-msg").innerText=`ConnectÃ© : ${user.email}`;
  loadHCUsers();
});

async function loadHCUsers(){
  tableBody.innerHTML="";
  const usersSnap = await getDocs(collection(db,"profiles"));
  usersSnap.forEach(docSnap=>{
    const data = docSnap.data();
    if(data.roles && data.roles.includes("HC")){
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${data.fullName||""}</td>
        <td>${data.email||""}</td>
        <td><input type="text" value="${data.matricule||""}" /></td>
        <td><input type="text" value="${data.phone||""}" /></td>
        <td><input type="text" value="${data.rib||""}" /></td>
        <td>${data.roles.join(", ")}</td>
        <td><button class="save-btn">ðŸ’¾ Sauvegarder</button></td>
      `;
      const saveBtn = tr.querySelector(".save-btn");
      saveBtn.addEventListener("click", async ()=>{
        await updateDoc(doc(db,"profiles",docSnap.id), {
          matricule: tr.children[2].querySelector("input").value,
          phone: tr.children[3].querySelector("input").value,
          rib: tr.children[4].querySelector("input").value
        });
        alert("âœ… Mis Ã  jour !");
      });
      tableBody.appendChild(tr);
    }
  });
}
</script>
</body>
</html>
