<!DOCTYPE html> 
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gestion Armes Blanches</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        form {
            margin-bottom: 20px;
        }
        input, select {
            padding: 5px;
            margin: 5px;
        }
        button {
            padding: 5px 10px;
            cursor: pointer;
        }
        @media (max-width: 600px) {
            table, th, td {
                font-size: 14px;
            }
            input, select, button {
                width: 100%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <h1>Armes Blanches</h1>

    <form id="form-stock">
        <input type="text" id="nom" placeholder="ETIQUETTE ARMES" required>
        <input type="number" id="quantite" placeholder="Quantité" min="0" required>
        <input type="text" id="date" placeholder="DATE D'ENTRE SAISIES" required>
        <input type="text" id="lieu" placeholder="LIEU DE SAISIE" required>
        <input type="text" id="provenance" placeholder="PROVENANCE PRÉSUMÉE" required>
        <input type="text" id="statut" placeholder="STATUT ACTUEL" required>
        <input type="text" id="affaires" placeholder="AFFAIRS LIÉE" required>

        <select id="typeArmes" required>
            <option value="">TYPE D'ARMES</option>
            <option>Couteau</option>
            <option>Poignard</option>
            <option>Epée</option>
        </select>

        <select id="calibre" required>
            <option value="">CALIBRE</option>
            <option>Petit</option>
            <option>Moyen</option>
            <option>Grand</option>
        </select>

        <select id="stockage" required>
            <option value="">STOCKAGE</option>
            <option>Armoire</option>
            <option>Box sécurisé</option>
            <option>Magasin</option>
        </select>

        <button type="submit">Ajouter</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>N° DE SAISIES</th>
                <th>ETIQUETTE ARMES</th>
                <th>Quantité</th>
                <th>TYPE D'ARMES</th>
                <th>CALIBRE</th>
                <th>DATE D'ENTRE SAISIES</th>
                <th>LIEU DE SAISIE</th>
                <th>PROVENANCE PRÉSUMÉE</th>
                <th>STATUT ACTUEL</th>
                <th>AFFAIRS LIÉE</th>
                <th>STOCKAGE</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tableau-stock"></tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDArc4SUw3MO06QJwD6xzEKsuKFsfVcjsQ",
            authDomain: "gestion-stock-d63d0.firebaseapp.com",
            projectId: "gestion-stock-d63d0",
            storageBucket: "gestion-stock-d63d0.firebasestorage.app",
            messagingSenderId: "865227689174",
            appId: "1:865227689174:web:213e7f6e44f183c6928d77",
            measurementId: "G-LX4G4FY0ZP"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const stockCollection = collection(db, "arme_blanche");

        let compteur = 1;

        async function ajouterArticle(article) {
            try {
                await addDoc(stockCollection, article);
            } catch (error) {
                console.error("Erreur lors de l'ajout :", error);
            }
        }

        async function supprimer(id) {
            if (!confirm("Voulez-vous vraiment supprimer cet article ?")) return;
            try {
                await deleteDoc(doc(db, "arme_blanche", id));
            } catch (error) {
                console.error("Erreur lors de la suppression :", error);
            }
        }

        function afficherStock() {
            const tbody = document.getElementById("tableau-stock");
            onSnapshot(stockCollection, (snapshot) => {
                tbody.innerHTML = "";
                compteur = 1;
                snapshot.forEach(docSnap => {
                    const item = docSnap.data();
                    const numero = "AB" + compteur.toString().padStart(6, "0");

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${numero}</td>
                        <td>${item.nom}</td>
                        <td>${item.quantite}</td>
                        <td>
                            <select onchange="modifierSelect('${docSnap.id}','typeArmes', this.value)">
                                <option ${item.typeArmes === "Couteau" ? "selected" : ""}>Couteau</option>
                                <option ${item.typeArmes === "Poignard" ? "selected" : ""}>Poignard</option>
                                <option ${item.ty
