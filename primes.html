<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Enregistrement Activités USMS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { font-family: Arial; margin: 20px; }
input, select, button { padding: 5px; margin: 5px; }
</style>
</head>
<body>
<h1>Enregistrement des activités</h1>

<label>Utilisateur:</label>
<input type="text" id="user-name" placeholder="Nom de l'agent">
<label>Rôle:</label>
<select id="role">
    <option value="FTF">FTF</option>
    <option value="JSD">JSD</option>
    <option value="SRT">SRT</option>
    <option value="AFD">AFD</option>
    <option value="COM">COM</option>
    <option value="HC">HC</option>
</select>

<div id="details-container"></div>
<button id="add-activity">Ajouter activité</button>

<script type="module">
import { db } from "./firebase.js";
import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const roleSelect = document.getElementById("role");
const detailsContainer = document.getElementById("details-container");

function updateDetailsForm() {
    const role = roleSelect.value;
    detailsContainer.innerHTML = "";
    if(role === "FTF"){
        detailsContainer.innerHTML = `<label>Reward Wanted:</label><input type="number" id="reward" min="0">`;
    } else if(role === "JSD"){
        detailsContainer.innerHTML = `<label>Durée audiences (heures, séparées par ,):</label><input type="text" id="audiences">`;
    } else if(role === "SRT" || role === "HC"){
        detailsContainer.innerHTML = `<label>Heures travaillées:</label><input type="number" id="hours" min="0">`;
    } else if(role === "AFD"){
        detailsContainer.innerHTML = `<label>Nombre de convois:</label><input type="number" id="convois" min="0">`;
    } else if(role === "COM"){
        detailsContainer.innerHTML = `<label>Publications:</label><input type="number" id="publications" min="0">`;
        detailsContainer.innerHTML += `<label>Vidéos:</label><input type="number" id="videos" min="0">`;
    }
}
roleSelect.addEventListener("change", updateDetailsForm);
updateDetailsForm();

document.getElementById("add-activity").addEventListener("click", async () => {
    const name = document.getElementById("user-name").value;
    const role = roleSelect.value;
    let details = {};

    if(role === "FTF") details.reward = parseFloat(document.getElementById("reward").value || 0);
    else if(role === "JSD") details.audiences = document.getElementById("audiences").value.split(",").map(h => parseFloat(h));
    else if(role === "SRT" || role === "HC") details.hours = parseFloat(document.getElementById("hours").value || 0);
    else if(role === "AFD") details.convois = parseInt(document.getElementById("convois").value || 0);
    else if(role === "COM") details.publications = parseInt(document.getElementById("publications").value || 0),
         details.videos = parseInt(document.getElementById("videos").value || 0);

    const now = new Date();
    const weekStart = new Date(now.setDate(now.getDate() - now.getDay())); 
    const weekEnd = new Date(now.setDate(now.getDate() - now.getDay() + 6));

    await addDoc(collection(db, "week_activities"), {name, role, details, weekStart, weekEnd});
    alert("Activité enregistrée !");
});
</script>
</body>
</html>
