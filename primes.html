<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Primes</title>
</head>
<body>
    <h1>Primes USMS</h1>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "TA_CLE_API",
            authDomain: "TON_PROJET.firebaseapp.com",
            projectId: "TON_PROJET",
            storageBucket: "TON_PROJET.appspot.com",
            messagingSenderId: "TON_PROJET",
            appId: "TON_PROJET",
            measurementId: "TON_PROJET"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "login.html";
                return;
            }
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);
            if (!docSnap.exists()) {
                window.location.href = "login.html";
                return;
            }

            const userData = docSnap.data();
            const role = userData.role;
            const currentPage = window.location.pathname.split("/").pop();
            const rolePages = {
                "AFD": ["armes_a_feu.html", "armes_blanche.html", "saisie_illegale.html", "saisie_legale.html"],
                "USMS": ["primes.html"]
            };

            if (!rolePages[role] || !rolePages[role].includes(currentPage)) {
                alert("Vous n'avez pas la permission d'accéder à cette page.");
                window.location.href = "index.html";
            }
        });
    </script>
</body>
</html>
