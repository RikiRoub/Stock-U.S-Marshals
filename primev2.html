<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard Agent</title>
</head>
<body>
<h1>Dashboard Agent</h1>

<div id="forms-container">
    <!-- FTF -->
    <div id="ftf-section">
        <h2>FTF</h2>
        <form id="ftf-form">
            Reward Wanted: <input type="number" id="ftf-reward" step="0.01"><br>
            Prime calculée: $<span id="ftf-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>

    <!-- JSD -->
    <div id="jsd-section">
        <h2>JSD</h2>
        <form id="jsd-form">
            Durée audience (heures): <input type="number" id="jsd-audience-hours" step="0.1"><br>
            Prime calculée: $<span id="jsd-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>

    <!-- SRT -->
    <div id="srt-section">
        <h2>SRT</h2>
        <form id="srt-form">
            Heures d'activité: <input type="number" id="srt-hours" step="0.1"><br>
            Prime calculée: $<span id="srt-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>

    <!-- AFD -->
    <div id="afd-section">
        <h2>AFD</h2>
        <form id="afd-form">
            Nombre de convois: <input type="number" id="afd-convoi" step="1"><br>
            Prime calculée: $<span id="afd-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>

    <!-- Com -->
    <div id="com-section">
        <h2>Com</h2>
        <form id="com-form">
            Publications: <input type="number" id="com-pub" step="1"><br>
            Vidéos: <input type="number" id="com-video" step="1"><br>
            Prime calculée: $<span id="com-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>

    <!-- HC -->
    <div id="hc-section">
        <h2>HC</h2>
        <form id="hc-form">
            Heures d'activité: <input type="number" id="hc-hours" step="0.1"><br>
            Prime calculée: $<span id="hc-prime">0</span><br>
            <button type="submit">Enregistrer</button>
        </form>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

const firebaseConfig = {
    apiKey: "AIzaSyDArc4SUw3MO06QJwD6xzEKsuKFsfVcjsQ",
    authDomain: "gestion-stock-d63d0.firebaseapp.com",
    projectId: "gestion-stock-d63d0",
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

async function saveActivity(role, prime, extraData={}) {
    const user = auth.currentUser;
    if(!user) return;
    try {
        await addDoc(collection(db, "weeklyActivities"), {
            userId: user.uid,
            role: role,
            prime: prime,
            data: extraData,
            createdAt: serverTimestamp()
        });
        alert("Activité enregistrée !");
    } catch(e) {
        console.error("Erreur enregistrement:", e);
    }
}

// FTF
document.getElementById("ftf-form").addEventListener("submit", async e=>{
    e.preventDefault();
    const reward = parseFloat(document.getElementById("ftf-reward").value) || 0;
    const prime = reward * 0.065;
    document.getElementById("ftf-prime").innerText = prime.toFixed(2);
    await saveActivity("FTF", prime, {reward});
});

// JSD
document.getElementById("jsd-form").addEventListener("submit", async e=>{
    e.preventDefault();
    let hours = parseFloat(document.getElementById("jsd-audience-hours").value) || 0;
    let prime = 125;
    if(hours > 1) prime += 125 * Math.floor(hours - 1);
    document.getElementById("jsd-prime").innerText = prime.toFixed(2);
    await saveActivity("JSD", prime, {hours});
});

// SRT
document.getElementById("srt-form").addEventListener("submit", async e=>{
    e.preventDefault();
    let hours = parseFloat(document.getElementById("srt-hours").value) || 0;
    let prime = hours * 20; // Exemple prime horaire
    document.getElementById("srt-prime").innerText = prime.toFixed(2);
    await saveActivity("SRT", prime, {hours});
});

// AFD
document.getElementById("afd-form").addEventListener("submit", async e=>{
    e.preventDefault();
    let convoys = parseInt(document.getElementById("afd-convoi").value) || 0;
    let prime = convoys * 500;
    document.getElementById("afd-prime").innerText = prime.toFixed(2);
    await saveActivity("AFD", prime, {convoys});
});

// Com
document.getElementById("com-form").addEventListener("submit", async e=>{
    e.preventDefault();
    let pub = parseInt(document.getElementById("com-pub").value) || 0;
    let video = parseInt(document.getElementById("com-video").value) || 0;
    let prime = pub*250 + video*500;
    document.getElementById("com-prime").innerText = prime.toFixed(2);
    await saveActivity("COM", prime, {pub, video});
});

// HC
document.getElementById("hc-form").addEventListener("submit", async e=>{
    e.preventDefault();
    let hours = parseFloat(document.getElementById("hc-hours").value) || 0;
    let prime = hours * 20; // Exemple prime horaire HC
    document.getElementById("hc-prime").innerText = prime.toFixed(2);
    await saveActivity("HC", prime, {hours});
});
</script>
</body>
</html>
