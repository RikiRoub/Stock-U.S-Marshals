<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Armes à Feu</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        input, select, button { padding: 5px; margin: 5px; }
        @media(max-width:600px){ table, th, td { font-size:14px; } input, select, button { width:100%; margin:5px 0; } }
    </style>
</head>
<body>
    <h1>Armes à Feu</h1>

    <form id="form-stock">
        <input type="text" id="nom" placeholder="ETIQUETTE ARMES" required>
        <input type="number" id="quantite" placeholder="Quantité" min="0" required>
        <input type="text" id="date" placeholder="DATE D'ENTRE SAISIES" required>
        <input type="text" id="lieu" placeholder="LIEU DE SAISIE" required>
        <input type="text" id="provenance" placeholder="PROVENANCE PRÉSUMÉE" required>
        <input type="text" id="statut" placeholder="STATUT ACTUEL" required>
        <input type="text" id="affaires" placeholder="AFFAIRS LIÉE" required>

        <select id="typeArmes" required>
            <option value="">TYPE D'ARMES</option>
            <option>Fusil</option>
            <option>Pistolet</option>
            <option>Mitrailleuse</option>
        </select>

        <select id="calibre" required>
            <option value="">CALIBRE</option>
            <option>9mm</option>
            <option>7.62mm</option>
            <option>.45 ACP</option>
        </select>

        <select id="stockage" required>
            <option value="">STOCKAGE</option>
            <option>Armoire</option>
            <option>Box sécurisé</option>
            <option>Magasin</option>
        </select>

        <button type="submit">Ajouter</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>N° DE SAISIES</th>
                <th>ETIQUETTE ARMES</th>
                <th>Quantité</th>
                <th>TYPE D'ARMES</th>
                <th>CALIBRE</th>
                <th>DATE D'ENTRE SAISIES</th>
                <th>LIEU DE SAISIE</th>
                <th>PROVENANCE PRÉSUMÉE</th>
                <th>STATUT ACTUEL</th>
                <th>AFFAIRS LIÉE</th>
                <th>STOCKAGE</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tableau-stock"></tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "VOTRE_API_KEY",
            authDomain: "VOTRE_AUTH_DOMAIN",
            projectId: "VOTRE_PROJECT_ID",
            storageBucket: "VOTRE_STORAGE_BUCKET",
            messagingSenderId: "VOTRE_MESSAGING_SENDER_ID",
            appId: "VOTRE_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const stockCollection = collection(db, "armes_a_feu");

        async function ajouterArticle(article) {
            try { await addDoc(stockCollection, article); }
            catch (e) { console.error("Erreur ajout:", e); }
        }

        async function supprimer(id) {
            if(!confirm("Voulez-vous supprimer cet article ?")) return;
            try { await deleteDoc(doc(db, "armes_a_feu", id)); }
            catch(e){ console.error("Erreur suppression:", e); }
        }

        function afficherStock() {
            const tbody = document.getElementById("tableau-stock");
            const q = query(stockCollection, orderBy("date", "asc"));
            onSnapshot(q, (snapshot)=>{
                tbody.innerHTML="";
                let compteur=1;
                snapshot.forEach(docSnap=>{
                    const item = docSnap.data();
                    const nSerie = "AAF"+String(compteur).padStart(6,"0");
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${nSerie}</td>
                        <td>${item.nom}</td>
                        <td>${item.quantite}</td>
                        <td>
                            <select onchange="modifierSelect('${docSnap.id}','typeArmes', this.value)">
                                <option ${item.typeArmes==="Fusil"?"selected":""}>Fusil</option>
                                <option ${item.typeArmes==="Pistolet"?"selected":""}>Pistolet</option>
                                <option ${item.typeArmes==="Mitrailleuse"?"selected":""}>Mitrailleuse</option>
                            </select>
                        </td>
                        <td>
                            <select onchange="modifierSelect('${docSnap.id}','calibre', this.value)">
                                <option ${item.calibre==="9mm"?"selected":""}>9mm</option>
                                <option ${item.calibre==="7.62mm"?"selected":""}>7.62mm</option>
                                <option ${item.calibre===".45 ACP"?"selected":""}>.45 ACP</option>
                            </select>
                        </td>
                        <td>${item.date}</td>
                        <td>${item.lieu}</td>
                        <td>${item.provenance}</td>
                        <td>${item.statut}</td>
                        <td>${item.affaires}</td>
                        <td>
                            <select onchange="modifierSelect('${docSnap.id}','stockage', this.value)">
                                <option ${item.stockage==="Armoire"?"selected":""}>Armoire</option>
                                <option ${item.stockage==="Box sécurisé"?"selected":""}>Box sécurisé</option>
                                <option ${item.stockage==="Magasin"?"selected":""}>Magasin</option>
                            </select>
                        </td>
                        <td><button onclick="supprimer('${docSnap.id}')">Supprimer</button></td>
                    `;
                    tbody.appendChild(row);
                    compteur++;
                });
            });
        }

        async function modifierSelect(id, champ, valeur){
            try { await doc(db,"armes_a_feu",id).update({ [champ]:valeur }); }
            catch(e){ console.error("Erreur modif:",e); }
        }
        window.modifierSelect = modifierSelect;
        window.supprimer = supprimer;

        document.getElementById("form-stock").addEventListener("submit", function(e){
            e.preventDefault();
            const article = {
                nom: document.getElementById("nom").value.trim(),
                quantite: parseInt(document.getElementById("quantite").value,10),
                date: document.getElementById("date").value.trim(),
                lieu: document.getElementById("lieu").value.trim(),
                provenance: document.getElementById("provenance").value.trim(),
                statut: document.getElementById("statut").value.trim(),
                affaires: document.getElementById("affaires").value.trim(),
                typeArmes: document.getElementById("typeArmes").value,
                calibre: document.getElementById("calibre").value,
                stockage: document.getElementById("stockage").value
            };
            ajouterArticle(article);
            this.reset();
        });

        afficherStock();
    </script>
</body>
</html>
